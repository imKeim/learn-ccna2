<!-- 4.5.3 -->
## Принципы маршрутизации между виртуальными локальными сетями

Узлы в одной VLAN не могут взаимодействовать с узлами в другой, если нет роутера или коммутатора уровня 3 для предоставления услуг маршрутизации. **Маршрутизация между VLAN** — это процесс переадресации сетевого трафика из одной VLAN в другую с помощью роутера. Три варианта включают устаревшие устройства, роутер на флешке и коммутатор уровня 3 с использованием SVI.

В предыдущих версий использовался роутер с несколькими интерфейсами Ethernet. Каждый интерфейс роутера был подключен к порту коммутатора в разных VLAN. По мере возрастания количества VLAN в сети, требующих по одному физическому интерфейсу на каждую, количество свободных интерфейсов роутера быстро уменьшается. 

Метод маршрутизации между VLAN **Router-on-a-Stick** требует только одного физического интерфейса Ethernet для маршрутизации трафика между несколькими VLAN в сети. Интерфейс Ethernet роутера Cisco IOS настроен как магистральное соединение 802.1Q и подключен к магистральному порту коммутатора уровня 2. Он настраивается с помощью подинтерфейсов для идентификации маршрутизируемых VLAN. **Подинтерфейсы** — это программные виртуальные интерфейсы, связанные с одним физическим.

**Современный метод** — маршрутизация между VLAN на коммутаторе уровня 3 с использованием SVI. Интерфейс SVI можно создать для любой сети VLAN, существующей на коммутаторе. SVI выполняет те же функции для VLAN, что и интерфейс роутера. Интерфейс SVI для VLAN обеспечивает обработку пакетов третьего уровня в обоих направлениях через порты коммутатора, связанные с этой VLAN.

## Использование метода Router-on-a-Stick

Чтобы настроить коммутатор с VLAN и транкингом, выполните следующие действия: создайте VLAN и присвойте им имена; создайте интерфейс управления; настройте порты доступа и порты магистрального соединения. Для использования метода **Router-on-a-Stick** требуется настроить подинтерфейсы для каждой маршрутизируемой VLAN. Подинтерфейс создается с помощью команды режима глобальной конфигурации **interface _interface_id subinterface_id_**.

Для осуществления маршрутизации каждому подинтерфейсу необходимо назначить IP-адрес в своей подсети. После создания всех подинтерфейсов физический интерфейс должен быть включен с помощью команды **no shutdown**. Проверьте подключение к узлу в другой VLAN с помощью команды **ping**. Используется **ping** для проверки подключения к узлу и коммутатору. Для проверки и устранения неполадок используйте команды **show ip route**, **show ip interface brief**, **show interfaces** и **show interfaces trunk**.

## Использование многоуровневых коммутаторов

Корпоративные локальные локальные сети предпочитают коммутаторы уровня 3 для обеспечения маршрутизации между VLAN. Эти устройства используют аппаратную коммутацию для достижения более высоких скоростей обработки пакетов, чем роутеры. Возможности **многоуровневого коммутатора** включают маршрутизацию между VLAN с помощью нескольких коммутируемых виртуальных интерфейсов (**SVI**), а также преобразование порта коммутации второго уровня в интерфейс третьего. Для обеспечения маршрутизации между VLAN коммутаторы уровня 3 используют SVI. SVI настраиваются с помощью той же команды интерфейса **vlan _vlan-id_**, которая используется для создания SVI управления на устройстве второго уровня.

Для каждой маршрутизируемой VLAN необходимо создать SVI уровня 3. Чтобы настроить коммутатор с VLAN и транкингом, выполните следующие действия: создайте VLAN; создайте интерфейсы VLAN SVI; настройте порты доступа; включите IP-маршрутизацию. Проверьте подключение к узлу в другой VLAN с помощью команды **ping**. Затем проверьте подключение к узлу с помощью команды Windows **ping**. VLAN должны обозначаться с использованием статической или динамической маршрутизации. Чтобы включить маршрутизацию на коммутаторе уровня 3, необходимо настроить маршрутизируемый порт. Он создается на коммутаторе уровня 3 путем отключения функции порта коммутатора на порту уровня 2, соединенном с другим устройством третьего уровня. 

Интерфейс может быть настроен с конфигурацией IPv4 для подключения к маршрутизатору или другому коммутатору уровня 3. Чтобы настроить роутер уровня 3 на маршрутизацию, выполните следующие действия: настройте маршрутизируемый порт; включите маршрутизацию; настройте ее; проверьте маршрутизацию и подключение.

## Поиск и устранение неполадок при маршрутизации между VLAN

Существует ряд причин, по которым конфигурация маршрутизации между VAN может не работать. Все они связаны с проблемами подключения, такими как отсутствие VLAN, проблемы порта магистрального коммутатора, проблемы порта доступа коммутатора и проблемы конфигурации роутера. VLAN может отсутствовать, если она не была создана, случайно удалена или не разрешена для магистрального канала. Другая проблема маршрутизации между VLAN связана с неправильной конфигурацией портов коммутатора.

В устаревшем решении проблема могла заключаться в назначении неправильного VLAN на порту коммутатора, к которому подключен роутер. При использовании решения **Router-on-a-Stick** наиболее распространенной причиной является неправильная конфигурация магистрального порта. При подозрении на проблему с конфигурацией порта доступа коммутатора используйте команды **ping** и **show interfaces _interface-id_ switchport** для определения проблемы. Проблемы конфигурации в методе **Router-on-a-Stick** могут быть также связаны с неправильными конфигурациями подинтерфейса. Проверьте состояние подинтерфейса с помощью команды **show ip interface brief**.

<!-- 4.5.4 -->
<!-- quiz -->
