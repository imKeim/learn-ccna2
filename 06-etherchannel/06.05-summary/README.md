<!-- 6.4.3 -->
## Принципы работы EtherChannel

Для увеличения пропускной способности или обеспечения резерва между устройствами может быть подключено несколько каналов связи. STP блокирует резервные каналы, чтобы избежать образования петель коммутации. **EtherChannel** — это технология агрегации каналов, позволяющая создавать резервные связи между устройствами, которые не будут блокироваться STP. 

EtherChannel группирует несколько физических каналов Ethernet в один логический. Он используется для обеспечения устойчивости к сбоям, распределения нагрузки, увеличения пропускной способности и обеспечения резерва между коммутаторами, роутерами и серверами. При настройке EtherChannel создается виртуальный интерфейс, который называется агрегированный канал (**port channel**). 

EtherChannel имеет несколько преимуществ, а также некоторые ограничения при создании. Его можно образовать путем согласования с использованием одного из двух протоколов PAgP или LACP. Данные протоколы позволяют портам со сходными характеристиками образовывать каналы путем динамического согласования со смежными коммутаторами. 

Когда EtherChannel сформирован с использованием проприетарного Cisco **PAgP**, пакеты PAgP отправляются между портами с поддержкой EtherChannel для согласования формирования канала.
**Режимы PAgP:** On (Вкл), PAgP desirable (рекомендуемый) и PAgP auto (автоматический).

**LACP** выполняет функцию, сходную с функциями PAgP для Cisco EtherChannel. Поскольку этот протокол относится к стандарту IEEE, его можно использовать для упрощения работы с EtherChannel в неоднородных средах.
**Режимы LACP:** On (Вкл), LACP active (активный) и LACP passive (пассивный).

## Настройка EtherChannel

При настройке EtherChannel рекомендуется соблюдать инструкции и ограничения.

- **Поддержка Etherchannel.** Все интерфейсы Ethernet на всех модулях должны поддерживать EtherChannel. При этом не требуется, чтобы эти интерфейсы были физически смежными или находились на одном модуле.
- **Скорость и дуплекс.** Все интерфейсы в EtherChannel должны быть настроены для работы на одной скорости и в одном режиме дуплекса.
- **Совпадения режма канала.** Все интерфейсы в объединении EtherChannel должны быть назначены в одной VLAN или настроены в качестве транкового канала.
- **Диапазон разрешенных VLAN.** EtherChannel поддерживает одинаковые разрешенные диапазоны VLAN на всех интерфейсах в канале транкинга EtherChannel.

Настройка EtherChannel с использованием LACP выполняется в три этапа.

**Шаг 1.** Укажите интерфейсы, которые составляют группу EtherChannel, с помощью команды **interface range** режима глобальной конфигурации.

**Шаг 2.** Создайте интерфейс канала порта с помощью команды **channel-group identifier mode active** в режиме конфигурации диапазона интерфейса.

**Шаг 3.** Чтобы изменить настройки второго уровня на интерфейсе канала порта, перейдите в режим интерфейсной настройки канала порта с помощью команды **interface port-channel**, после которой необходимо указать идентификатор интерфейса.

**Поиск и устранение проблем в работе EtherChannel**

Для проверки конфигурации EtherChannel доступно несколько команд, включая **show interfaces port-channel**, **show etherchannel summary**, **show etherchannel port-channel** и **show interfaces etherchannel**.

Есть несколько распространенных проблем EtherChannel.

* Назначенные порты в EtherChannel не являются частью одной VLAN или не настроены как транки. Порты с различными Native VLAN не могут образовать EtherChannel.
* Транк был настроен на некоторых портах, которые составляют EtherChannel, но не на всех из них.
* Если диапазоны разрешtнных VLAN не совпадают, порты не смогут сформировать EtherChannel даже при выборе auto или desirable режимов для PAgP.
* Параметры динамического согласования для PAgP и LACP не совместимы на обоих концах EtherChannel.

<!-- 6.4.4 -->
<!-- quiz -->
