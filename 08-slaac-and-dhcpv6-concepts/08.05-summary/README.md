<!-- 8.5.2 -->
## Назначение GUA IPv6

На роутере глобальные одноадресные адреса IPv6 настраиваются вручную с помощью команды конфигурации интерфейса **ipv6 address _ipv6-address/prefix-length_**. Если выбрана автоматическая IPv6-адресация, хост попытается автоматически получить и настроить информацию об IPv6-адресах на интерфейсе. Локальный адрес канала IPv6 автоматически создается хостом при загрузке и активном интерфейсе Ethernet. 

По умолчанию роутер с поддержкой IPv6 сообщает информацию IPv6, что позволяет хосту динамически создавать или приобретать конфигурацию IPv6. GUA IPv6 может быть назначен динамически с помощью служб без состояния и состояния. 

Решение о том, как клиент получит GUA IPv6, зависит от настроек в сообщении RA. Сообщение ICMPv6 RA содержит три флага для определения динамических параметров, доступных хосту:

* **флаг А** (флаг автонастройки адреса, используется SLAAC для создания GUA IPv6);
* **флаг Other Configuration (флаг O)** (флаг конфигурации Other, другая информация доступна с сервера DHCPv6 без состояния);
* **флаг Managed Address Configuration (флаг M)** (флаг настройки управляемого (managed) адреса, используется сервер DHCPv6 с сохранением состояния для получения GUA IPv6.

## SLAAC

Метод SLAAC позволяет хостам создавать свой собственный уникальный глобальный одноадресный IPv6 без использования служб DHCPv6 сервера. SLAAC использует ICMPv6-сообщения запроса и объявления роутера, чтобы предоставить информацию об адресации и другие сведения о конфигурации, обычно сообщаемые DHCP-сервером. SLAAC может быть развернут только как SLAAC или SLAAC с DHCPv6. 

Чтобы включить отправку сообщений RA, роутер должен присоединиться к группе IPv6 all-routers с помощью команды **ipv6 unicast-routing** глобальной конфигурации. Используйте команду **show ipv6 interface**, чтобы проверить, включена ли маршрутизация. Метод SLAAC только включен по умолчанию при настройке команды **ipv6 unicast-routing**. Все включенные интерфейсы Ethernet с настроенным GUA IPv6 начнут отправлять сообщения RA с флагом A равным 1, а флаги O и M — 0. Флаг A равен 1 и предлагает клиенту создать свой собственный IPv6 GUA, используя префикс, объявленный в РА. Флаги O и M равны 0 и велят клиенту использовать информацию исключительно в сообщении RA. Роуте отправляет RA-сообщения каждые 200 секунд. Тем не менее, он также отправит его, если получит сообщение RS от хоста.

Используя SLAAC, хост обычно получает информацию о 64-битной подсети IPv6 от роутера RA. Однако он должен генерировать оставшийся 64-битный идентификатор интерфейса (ID) одним из двух методов: **случайной генерации** или **EUI-64**. **Процесс обнаружения дубликатов адресов** (DAD) используется хостом для обеспечения уникальности GUA IPv6. DAD реализован с использованием ICMPv6. Для выполнения этого процесса хост отправляет сообщение NS ICMPv6 со специально сконструированным адресом, называемым адресом многоадресной рассылки запрошенного узла. Этот адрес дублирует последние 24 бита IPv6-адреса узла.

## DHCPv6

Если вариант работы DHCPv6 указан в сообщении RA, устройство начинает обмен данными по схеме клиент-сервер с использованием DHCPv6. Сообщения DHCPv6 от сервера к клиенту используют UDP-порт назначения 546, а от клиента к серверу – 547.

DHCPv6 без отслеживания состояния сообщает клиенту об использовании информации в сообщении RA для адресации, при этом дополнительные параметры конфигурации доступны с сервера DHCPv6. Это называется DHCPv6 без учета состояния, поскольку сервер не поддерживает сведения о состоянии клиента. DHCPv6 без состояния включен на интерфейсе роутера с помощью команды **ipv6 nd other-config-flag**. Это устанавливает флаг O в 1.

В DHCPv6 с сохранением состояния сообщение RA дает клиенту получить всю информацию об адресации с сервера DHCPv6 с сохранением состояния, за исключением адреса шлюза по умолчанию, который является исходным IPv6 локальным адресом канала RA. DHCPv6 с протоколом состояния включен на интерфейсе роутера с помощью команды конфигурации интерфейса **ipv6 nd managed-config-flag**. Это устанавливает флаг M в 1.

## Настройка сервера DHCPv6

Роутер Cisco IOS может быть настроен на предоставление служб сервера DHCPv6 в качестве одного из **трех типов**: сервер DHCPv6, клиент DHCPv6 или агент ретрансляции DHCPv6. Параметр DHCPv6-сервера без учета состояния требует, чтобы роутер объявлял информацию о сетевой IPv6-адресации в сообщениях RA. Роутер также может быть клиентом DHCPv6 и получать конфигурацию IPv6 с сервера DHCPv6. Параметр DHCP-сервера с поддержкой состояния требует, чтобы устройство с поддержкой IPv6 велело узлу связаться с сервером DHCPv6 для получения всех необходимых сведений о сетевой IPv6-адресации.

Чтобы клиентский роутер поддерживал DHCPv6, ему необходимо настроить опцию **ipv6 unicast-routing**, включить и локальный адрес канала IPv6 для отправки и получения сообщений IPv6. Используйте команды **show ipv6 dhcp pool** и **show ipv6 dhcp binding** для проверки работы DHCPv6 на роутере. Если сервер DHCPv6 находится в сети, отличной от клиентской, роутер IPv6 можно настроить в качестве агента ретрансляции DHCPv6 с помощью команды **ipv6 dhcp relay destination _ipv6-address \[interface-type interface-number \]_**. Эта команда настраивается на интерфейсе, обращенном к клиентам DHCPv6, и указывает адрес сервера DHCPv6 и исходящий интерфейс для доступа к серверу. Исходящего интерфейса требуется только в том случае, если адрес следующего перехода является LLA. Убедитесь, что агент ретрансляции DHCPv6 работает с командами **show ipv6 dhcp interface** и **show ipv6 dhcp binding**.

<!-- 8.5.3 -->
<!-- quiz -->
