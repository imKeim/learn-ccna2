<!-- 9.2.1 -->
## Общие сведения о протоколе HSRP

Cisco предоставляет HSRP и HSRP для IPv6 как способ избежать потери доступа к внешней сети в случае сбоя роутера по умолчанию.

Проприетарный протокол Cisco FHRP предназначен для обеспечения сквозного переключения IPv4-устройства первого перехода.

Протокол HSRP обеспечивает высокую доступность сети благодаря предоставлению функций обеспечения резерва для маршрутизации на первом хопе для IPv4-узлов в сетях, настроенных с использованием IPv4-адреса шлюза по умолчанию. HSRP используется группой роутеров для выбора активного и резервного устройств. В рамках группы интерфейсов устройства активным называется то, которое используется для маршрутизации пакетов, а резервным — то, которое задействуется в случае сбоя активного устройства или при выполнении предварительно заданных условий. Задача резервного роутера HSRP заключается в мониторинге рабочего состояния группы HSRP и быстром переходе к выполнению функций пересылки пакетов в случае сбоя активного устройства.

<!-- 9.2.2 -->
## Приоритет и приоритетное вытеснение HSRP

Роль активных и резервных роутеров определяется во время процесса выбора HSRP. По умолчанию в качестве активного выбирается устройство с максимальным в численном отношении адресом IPv4. Однако всегда лучше контролировать, как сеть будет работать в нормальных условиях, чем оставлять это на волю случая.

**HSRP Priority**

Для определения активного роутера можно использовать приоритет HSRP. Устройство с наивысшим приоритетом HSRP станет активным. По умолчанию приоритет HSRP равен 100. Если приоритеты равны, в качестве активного выбирается роутер с максимальным в численном отношении адресом IPv4.

Чтобы настроить его в качестве активного, используйте команду интерфейса **standby priority**. Приоритеты HSRP имеют диапазон от 0 до 255.

**HSRP Preemption**

По умолчанию, после того как роутер становится активным, он остается таковым, даже если в сети появляется другое устройство с более высоким приоритетом HSRP.

Чтобы провести новый процесс выборов HSRP, когда роутер с более высоким приоритетом подключается в оперативный режим, необходимо включить параметр **preemption** с помощью команды **standby preempt _interface_**. **Приоритетное вытеснение** — это способность роутера HSRP запускать процесс повторного выбора. Если приоритетное вытеснение включено, то при появлении в сети роутера с более высоким приоритетом HSRP он становится активным.

Приоритетное вытеснение позволяет устройству стать активным, только если у него более высокий приоритет. Если у него такой же приоритет, но больший адрес IPv4, он не будет вытеснять действующий активный роутер. Посмотрите топологию на рисунке.

![](./assets/9.2.2.svg)


R1 имеет приоритет HSRP, равный 150, а R2 имеет приоритет HSRP по умолчанию, равный 100. На R1 включено приоритетное вытеснение. Благодаря большему приоритету этот роутер является активным, а второй — резервным.  В результате сбоя питания, который коснулся только R1, активный роутер становится недоступным и резервный принимает роль активного. После восстановления питания R1 возвращается в сеть. Поскольку он имеет более высокий приоритет и включено приоритетное вытеснение, будет запущен новый процесс выбора. R1 снова принимает роль активного устройства, а R2 возвращает себе роль резервного.

**Примечание.** Если приоритетное вытеснение отключено, активным роутером становится первый загруженный, если во время процесса выбора в сети нет других вариантов.

<!-- 9.2.3 -->
## Состояния и таймеры HSRP

Роутер может быть либо активным устройством HSRP, которое отвечает за пересылку трафика для сегмента, либо пассивным в резерве, который готов принять на себя активную роль в случае сбоя первого устройства. Если на интерфейсе включен HSRP или интерфейс впервые активируется в существующей конфигурации HSRP, роутер отправляет и получает пакеты приветствия HSRP, чтобы начать процесс определения того, какое состояние в группе HSRP он примет.

В таблице приведена сводная информация по состояниям HSRP.

| **Состояния HSRP** | **Описание** |
| --- | --- |
| Initial (начальное) | Это состояние возникает при изменении конфигурации или в том случае, когда интерфейс впервые становится доступным. |
| Learn (Получение информации) | Роутер не определил виртуальный IP-адрес и пока не получил сообщение приветствия от активного устройства. В этом состоянии он ожидает получения сообщения приветствия от активного роутера. |
| Listen (прослушивание) | Роутеру известен виртуальный IP-адрес, но он не является ни активным, ни резервным. Он прослушивает сообщения приветствия от этих устройств. |
| Speak (приветствие) | Роутер периодически отправляет сообщения приветствия и активно участвует в выборах активного и (или) резервного устройства. |
| Standby (Резервный) | Роутер является кандидатом на роль следующего активного и периодически отправляет сообщения приветствия. |

По умолчанию активные и резервные роутеры HSRP отправляют пакеты приветствия на групповой адрес группы HSRP каждые 3 секунды. Резервный станет активным, если он не получает сообщения приветствия от активного устройства в течение 10 секунд. Эти настройки таймера можно уменьшить, чтобы ускорить переключение при отказе или приоритетное вытеснение. Однако, чтобы избежать повышения нагрузки на ЦП и ненужных изменений резервного состояния, не устанавливайте таймер приветствия менее, чем на 1 секунду, а таймер удержания — менее, чем на 4 секунды.

<!-- 9.2.4 -->
<!-- quiz -->
