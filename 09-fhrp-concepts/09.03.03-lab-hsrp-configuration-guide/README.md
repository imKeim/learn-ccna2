
---

> **ВАЖНО**
> 
> Форма для ответов на вопросы будет доступна только при развертывании лабораторной работы 

---

## Топология

![](./assets/topology.png)

## Таблица адресации

| **Устройство**             | **Интерфейс**   | **IP-адрес**           | **Шлюз по умолчанию** |
|------------------------|-------------|--------------------|-------------------|
| R1                     | G0/0        | 10.1.1.1/30        | —                 |
| R1                     | G0/1        | 192.168.1.1/24     | —                 |
| R1                     | G0/2        | 10.1.1.9/30        | —                 |
| R2                     | G0/0        | 10.1.1.2/30        | —                 |
| R2                     | G0/1        | 10.1.1.5/30        | —                 |
| R2                     | G0/2        | 10.100.100.1/30    | —                 |
| R3                     | G0/0        | 192.168.1.3/24     | —                 |
| R3                     | G0/1        | 10.1.1.6/30        | —                 |
| R3                     | G0/2        | 10.1.1.10/30       | —                 |
| I-Net                  | G0/1        | 10.100.100.2/30    | Нет               |
| Виртуальные шлюзы HSRP | Виртуальные | 192.168.1.254/24   | —                 |
| S1                     | VLAN 1      | 192.168.1.11/24    | 192.168.1.1       |
| S3                     | VLAN 1      | 192.168.1.13/24    | 192.168.1.3       |
| PC-A                   | NIC         | 192.168.1.101/24   | 192.168.1.1       |
| PC-B                   | NIC         | 192.168.1.103/24   | 192.168.1.3       |
| Веб-сервер             | NIC         | 209.165.200.226/27 | 209.165.100.225   |

**Примечание.** Роутер I-Net присутствует в облаке Интернета и не может быть доступен в этом задании.

## Цели

В этом задании Packet Tracer вы узнаете, как настроить протокол HSRP для предоставления избыточных шлюзов по умолчанию узлам в локальных сетях. После настройки HSRP вы проведете проверку, чтобы убедиться, что узлы могут использовать рузервный шлюз по умолчанию, если активное устройство недоступно.

**Задачи:**

-   настроить активный роутер HSRP;

-   настроить резервный роутер HSRP;

-   проверить работу протокола HSRP.

## Общие сведения и сценарий

Связующее дерево обеспечивает резервирование коммутаторами в локальной сети, не допуская возникновения петель. Но оно не позволяет организовать в сети резервирование шлюзов по умолчанию для устройств конечных пользователей на случай сбоя одного из роутеров. Протоколы обеспечения резерва на первом хопе (First Hop Redundancy Protocols, FHRP) предоставляют резервные шлюзы по умолчанию для оконечных устройств. При этом конфигурация конечного пользователя не требуется. При совместном использовании IP и MAC-адреса два или более роутера могут работать как один виртуальный. Узлы в сети настроены с общим IP-адресом в качестве шлюза по умолчанию. В этом заданнии Packet Tracer будет настроен протокол горячего резервного роутера Cisco (HSRP), который является FHRP.

Настройка HSRP будет осуществляться на R1 и R3, которые служат шлюзами по умолчанию для узлов LAN 1 и LAN 2. При настройке HSRP создается виртуальный шлюз, который использует один и тот же адрес шлюза по умолчанию для узлов в обеих локальных сетях. Если один роутер становится недоступным, второй будет использовать тот же адрес шлюза по умолчанию, что и первый. Поскольку узлы в локальных сетях настроены с IP-адресом виртуального шлюза, они восстановят подключение к удаленным сетям после того, как HSRP активирует оставшийся роутер.

## Инструкции

### Часть 1. Проверка подключения

**Шаг 1. Выполните трассировку маршрута от PC-A к веб-серверу**

1.  Перейдите на рабочий стол PC-A и откройте командную строку.

2.  Проследите путь от PC-A к веб-серверу, выполнив команду **tracert 209.165.200.226**.

    - Ответьте на вопрос №1

**Шаг 2. Выполните трассировку маршрута от PC-A к веб-серверу**

Повторите шаг 2 для PC-B.

- Ответьте на вопрос №2

**Шаг 3. Наблюдайте за поведением сети, когда R3 становится недоступным**

1.  Выберите инструмент удаления на панели инструментов Packet Tracer и удалите связь между **R3** и **S3**.

2.  Откройте командную строку на PC-B. Выполните команду **tracert** с веб-сервером в качестве места назначения.

3.  Сравните текущий вывод с выводами команды из шага 2.

4.  Щелкните иконку **Connections** в нижнем левом углу окна Packet Tracer. Найдите и выберите значок **Copper Straight-Through** в меню типов соединений.

5.  Нажмите на **S3** и выберите порт **GigbitEthernet0/2**. Нажмите на **R3** и выберите порт **GigabitEthernet0/0**.

6.  После того, как на канале загорится зеленый цвет, проверьте подключение, отправив **ping**-запросы до Web Server. На них должны приходить ответы.

### Часть 2. Настройка активных и резервных роутеров HSRP

**Шаг 1. Настройте протокол HSRP на R1**

1.  Настройте HSRP на интерфейсе локальной сети G0/1 R1.

    ```
    R1(config)# interface g0/1
    ```

2. Укажите номер версии протокола HSRP. Самая последняя — версия **2**.

    **Примечание.** Резервная версия 1 поддерживает только IPv4-адресацию.

    ```
    R1(config-if)# standby version 2
    ```

3. Настройте IP-адрес виртуального шлюза по умолчанию. Этот адрес должен быть настроен на всех узлах, которым требуются службы этого шлюза. Он заменяет физический адрес интерфейса роутера, который ранее был настроен на узлах.

    На роутере можно настроить несколько экземпляров HSRP. Необходимо указать номер группы HSRP для идентификации виртуального интерфейса между устройствами в группе HSRP. Этот номер должен быть согласован между ними. Номер группы для этой конфигурации — 1.

    ```
    R1(config-if)# standby 1 ip 192.168.1.254
    ```

4. Укажите активный роутер для группы HSRP. Он будет использоваться в качестве устройства шлюза, если только не выйдет из строя или путь к нему не станет непригодным для использования. Укажите приоритет интерфейса роутера. Значение по умолчанию — 100. Более высокое значение определяет, какое устройство является активным. Если приоритеты в группе HSRP одинаковы, роутер с самым высоким настроенным IP-адресом станет активным.

    ```
    R1(config-if)# standby 1 priority 150
    ```

    R1 будет работать в качестве активного роутера, а трафик из двух локальных сетей будет использовать его в качестве шлюза по умолчанию.

5. Если необходимо, чтобы активное устройство возобновило эту роль, когда оно снова станет доступным, настройте его на упреждающий запуск службы резервного роутера. Активный же возьмет на себя роль шлюза, когда он снова станет работоспособным.

    ```
    R1(config-if)# standby 1 preempt
    ```

    - Ответьте на вопрос №3

**Шаг 2. Настройте протокол HSRP на R3**

Настройте R3 в качестве резервного роутера.

1. Настройте интерфейс R3, подключенный к локальной сети 2.

2. Повторите только шаги 1.2 и 1.3 выше.

**Шаг 3. Проверьте настройки HSRP**

1. Проверьте HSRP, выполнив команду **show standby** на R1 и R3. Проверьте значения роли HSRP, группы, виртуального IP-адреса шлюза и приоритета. Обратите внимание, что HSRP также определяет активные и резервные IP-адреса роутера для группы.

    ```
    R1# show standby
    GigabitEthernet0/1 - Group 1 (version 2)
      State is Active
        4 state changes, last state change 0:00:30
      Virtual IP address is 192.168.1.254
      Active virtual MAC address is 0000.0C9F.F001
        Local virtual MAC address is 0000.0C9F.F001 (v2 default)
      Hello time 3 sec, hold time 10 sec
        Next hello sent in 1.696 secs
      Preemption enabled
      Active router is local
      Standby router is 192.168.1.3
      Priority 150 (configured 150)
      Group name is "hsrp-Gi0/1-1" (default)
    ```

    ```
    R3# show standby
    GigabitEthernet0/0 - Group 1 (version 2)
      State is Standby
        4 state changes, last state change 0:02:29
      Virtual IP address is 192.168.1.254
      Active virtual MAC address is 0000.0C9F.F001
        Local virtual MAC address is 0000.0C9F.F001 (v2 default)
      Hello time 3 sec, hold time 10 sec
        Next hello sent in 0.720 secs
      Preemption disabled
      Active router is 192.168.1.1
        MAC address is d48c.b5ce.a0c1
      Standby router is local
      Priority 100 (default 100)
      Group name is "hsrp-Gi0/0-1" (default)
    ```

    Используя указанные выше выходные данные, ответьте на следующие вопросы:

    - вопрос №4

    - вопрос №5

    - вопрос №6

2. Используйте команду **show standby brief** на R1 и R3, чтобы просмотреть сводку состояния HSRP. Выходные данные приведены ниже.

    ```
    R1# show standby brief
                       P indicates configured to preempt.
                       |
    Interface Grp Pri P State Active Standby Virtual IP
    Gi0/1 1 150 P Active local 192.168.1.3 192.168.1.254

    R3# show standby brief
                       P indicates configured to preempt.
                       |
    Interface Grp Pri P State Active Standby Virtual IP
    Gi0/0 1 100 Standby 192.168.1.1 local 192.168.1.254
    ```

3. Измените адрес шлюза по умолчанию для PC-A, PC-C, S1 и S3.

    - Ответьте на вопрос №7

    Проверьте новые настройки. Выполните команду ping от PC-A и PC-C на веб-сервер. 
    
    - Ответьте на вопрос №8

### Часть 3. Наблюдение за работой HSRP

**Шаг 1. Сделайте активный роутер недоступным**

Откройте командную строку на **PC-B** и введите команду **tracert 209.165.200.226** .

- Ответьте на вопрос №9

**Шаг 2. Разровите канал до R1**

1. Выберите инструмент удаления на панели инструментов Packet Tracer и удалите кабель, соединяющий R1 с S1.

2. Вернитесь на PC-B и снова выполните команду **tracert 209.165.200.226**. Наблюдайте за выводом команды, пока она не завершит выполнение. Возможно, потребуется повторить трассировку, чтобы увидеть полный путь.

    - Ответьте на вопрос №10

    HSRP запускает процесс определения того, какой роуте должен взять на себя роль активного, когда текущий становится недоступным. Этот процесс требует времени. После его завершения резервный роутер R3 становится активным и используется в качестве шлюза по умолчанию для узлов LAN 1 и LAN 2.

**Шаг 3. Восстановите канал до R1**

1. Повторно подключите R1 к S1 с помощью медного прямого кабеля.

2. Выполните трассировку от компьютера PC-B до веб-сервера. Возможно, потребуется повторить ее, чтобы увидеть полный путь.

    - Ответьте на вопрос №11

    - Ответьте на вопрос №12

[Скачать файл Packet Tracer для локального запуска](./assets/9.3.3-lab.pka)
