<!-- 10.4.1 -->
## Обзор работы коммутатора

В этом разделе основное внимание по-прежнему уделяется коммутаторам, в частности их таблицам MAC-адресов и их уязвимости для атак.

Напомним, что для принятия решений о переадресации коммутатор LAN уровня 2 создает таблицу на основе MAC-адресов источника в принятых кадрах. Такие таблицы хранятся в памяти и используются для более эффективной пересылки кадров.

```
S1# show mac address-table dynamic
          Mac Address Table
-------------------------------------------
Vlan    Mac Address       Type        Ports
----    -----------       --------    -----
   1    0001.9717.22e0    DYNAMIC     Fa0/4
   1    000a.f38e.74b3    DYNAMIC     Fa0/1
   1    0090.0c23.ceca    DYNAMIC     Fa0/3
   1    00d0.ba07.8499    DYNAMIC     Fa0/2
S1#
```

<!-- 10.4.2 -->
## Атака переполнением на таблицу MAC-адресов

Все таблицы MAC имеют фиксированный размер и, следовательно, коммутатор может исчерпать ресурсы для хранения MAC-адресов. Атаки с переполнением таблицы MAC-адресов используют это ограничение, отправляя фиктивные адреса источника, до тех пор, пока таблица коммутатора не заполнится и коммутатор не сможет правильно работать дальше.

Когда это происходит, коммутатор обрабатывает кадр как неизвестную одноадресную рассылку и начинает пересылать весь входящий трафик из всех портов в той же VLAN без учета таблицы MAC. Это условие теперь позволяет атакующему захватить все кадры, отправленные с одного хоста на другой в локальной сети или VLAN.

**Примечание.** Трафик лавинообразно пересылается только внутри локальной сети или VLAN. Злоумышленник может захватывать трафик только в локальной сети или VLAN, к которой подключен исполнитель угрозы.

На рисунке показано, как исполнитель угрозы может легко использовать инструмент сетевой атаки **macof** для переполнения таблицы MAC-адресов.

![](./assets/10.4.2.svg)


1. Исполнитель угрозы подключен к VLAN 10 и использует **macof** для быстрой генерации множества случайных MAC-адресов источника и назначения и IP-адресов.
2. За короткий промежуток времени таблица MAC коммутатора заполняется.
3. Когда она заполнена, коммутатор начинает заполнять все кадры, которые он получает. Пока **macof** продолжает работать, таблица остается заполненной, а коммутатор продолжает заполнять все входящие кадры из каждого порта, связанного с VLAN 10.
4. Затем атакующий использует программное обеспечение для отслеживания пакетов для захвата кадров с любого и всех устройств, подключенных к VLAN 10.

Если злоумышленник остановит **macof**, список старых записей MAC-адресов через некоторое время устареет, и коммутатор снова начинает работать нормально.

<!-- 10.4.3 -->
## Противодействие атакам на таблицы CAM

Что делает такие инструменты, как **macof**, настолько опасными, так это то, что злоумышленник может очень быстро создать атаку переполнения таблицы MAC. Например, коммутатор Catalyst 6500 может хранить 132 000 MAC-адресов в своей таблице. Такой инструмент, как **macof**, может переключать скорость до 8000 поддельных кадров в секунду и создать атаку переполнения таблицы MAC-адресов за несколько секунд. В примере показан вывод команды **macof** на хосте Linux.

```
# macof -i eth1
36:a1:48:63:81:70 15:26:8d:4d:28:f8 0.0.0.0.26413 > 0.0.0.0.49492: S 1094191437:1094191437(0) win 512 
16:e8:8:0:4d:9c da:4d:bc:7c:ef:be 0.0.0.0.61376 > 0.0.0.0.47523: S 446486755:446486755(0) win 512 
18:2a:de:56:38:71 33:af:9b:5:a6:97 0.0.0.0.20086 > 0.0.0.0.6728: S 105051945:105051945(0) win 512 
e7:5c:97:42:ec:1 83:73:1a:32:20:93 0.0.0.0.45282 > 0.0.0.0.24898: S 1838062028:1838062028(0) win 512 
62:69:d3:1c:79:ef 80:13:35:4:cb:d0 0.0.0.0.11587 > 0.0.0.0.7723: S 1792413296:1792413296(0) win 512 
c5:a:b7:3e:3c:7a 3a:ee:c0:23:4a:fe 0.0.0.0.19784 > 0.0.0.0.57433: S 1018924173:1018924173(0) win 512 
88:43:ee:51:c7:68 b4:8d:ec:3e:14:bb 0.0.0.0.283 > 0.0.0.0.11466: S 727776406:727776406(0) win 512 
b8:7a:7a:2d:2c:ae c2:fa:2d:7d:e7:bf 0.0.0.0.32650 > 0.0.0.0.11324: S 605528173:605528173(0) win 512 
e0:d8:1e:74:1:e 57:98:b6:5a:fa:de 0.0.0.0.36346 > 0.0.0.0.55700: S 2128143986:2128143986(0) win 512
```

Другая причина, по которой эти инструменты атаки опасны, заключается в том, что они не только влияют на локальный коммутатор, но и на другие подключенные коммутаторы уровня 2. Когда таблица MAC-адресов заполнена, она начинает заполнять все порты, включая те, которые подключены к другим коммутаторам уровня 2.

Чтобы нейтрализовать атаки переполнения таблицы MAC-адресов, сетевые администраторы должны реализовать защиту портов (Port security). Это позволит узнать только определенное количество исходных MAC-адресов порта. Безопасность порта дополнительно рассматривается в другом модуле.

<!-- 10.4.4 -->
<!-- quiz -->
