<!-- 11.3.1 -->
## Обзор атак DHCP

Цель **атаки с истощением DHCP** – создать отказ в обслуживании (DoS) для подключения клиентов. Для ее реализации необходим специальный инструмент, например, Gobbler. Напомним, что атаки истощение DHCP могут быть эффективно смягчены с помощью защиты портов, поскольку Gobbler использует уникальный MAC-адрес источника для каждого отправляемого запроса DHCP.

Однако для нейтрализации атак подмены DHCP требуется больше защиты. Gobbler может быть настроен на использование фактического MAC-адреса интерфейса в качестве адреса Ethernet источника, но при этом указать другой адрес Ethernet в полезной нагрузке DHCP-пакета. Это сделало бы безопасность порта неэффективной, потому что MAC-адрес источника был бы легитимным.

Атаки DHCP-спуфинга можно предотвратить, используя анализ DHCP-трафика на доверенных портах.

<!-- 11.3.2 -->
## Отслеживание DHCP-сообщений

Отслеживание DHCP не зависит от MAC-адресов источника. Вместо этого, DHCP-Snooping определяет, является ли DHCP-сообщение от административно сконфигурированных доверенного или ненадежного источника. Затем он фильтрует сообщения и объем DHCP трафика из ненадежных источников.

Устройства, находящиеся под вашим административным контролем, такие как коммутаторы, роутеры и серверы, являются надежными источниками. Любое устройство вне брандмауэра или вне вашей сети является ненадежным, как и любой порт доступа. На рисунке показан пример доверенных и ненадежных портов.

![](./assets/11.3.2.svg)


Обратите внимание, что вредоносный сервер DHCP будет на ненадежном порту после включения DHCP-отслеживания. Все интерфейсы по умолчанию считаются ненадежными. Доверенные интерфейсы, как правило, магистральные связи и порты, непосредственно связанные с легитимным сервером DHCP. Они должны быть явно настроены как доверенные.

Создается таблица DHCP, которая включает MAC-адрес источника устройства на ненадежном порту и IP-адрес, назначенный сервером DHCP этому устройству. MAC и IP-адрес связаны друг с другом. Поэтому эта таблица называется таблицей привязки отслеживания DHCP.

<!-- 11.3.3 -->
## Реализация DHCP-Snooping

Чтобы включить отслеживание DHCP, выполните несколько шагов.

**Шаг 1.** Включите отслеживание DHCP с помощью команды глобальной конфигурации **ip dhcp snooping**.

**Шаг 2.** На доверенных портах используйте команду настройки интерфейса **ip dhcp snooping trust**.

**Шаг 3.** Ограничьте число сообщений обнаружения DHCP, которые могут приниматься в секунду на ненадежных портах, с помощью команды настройки интерфейса **ip dhcp snooping limit rate**.

**Шаг 4.** Включите отслеживание DHCP по VLAN или по диапазону виртуальных локальных сетей с помощью команды глобальной конфигурации **ip dhcp snooping _vlan_**.

<!-- 11.3.4 -->
## Пример настройки DHCP-Snooping

Примерная топология для этого примера DHCP-Snooping показана на рисунке. Обратите внимание, что F0/5 является ненадежным портом, потому что он подключается к ПК. F0/1 является доверенным портом, поскольку он подключается к серверу DHCP.

![](./assets/11.3.4.svg)


Ниже приведен пример настройки отслеживания DHCP на S1. Обратите внимание, как DHCP-Snooping впервые включен. Тогда вышестоящий интерфейс к серверу DHCP явно является доверенным. Далее, диапазон портов FastEthernet от F0/5 до F0/24 по умолчанию ненадежен, поэтому ограничение скорости установлено в шесть пакетов в секунду. Наконец, отслеживание DHCP включено в VLAN 5, 10, 50, 51 и 52.

```
S1(config)# ip dhcp snooping
S1(config)# interface f0/1
S1(config-if)# ip dhcp snooping trust
S1(config-if)# exit
S1(config)# interface range f0/5 - 24
S1(config-if-range)# ip dhcp snooping limit rate 6
S1(config-if-range)# exit
S1(config)# ip dhcp snooping vlan 5,10,50-52
S1(config)# end
S1#
```

Используйте привилегированную команду EXEC **show ip dhcp snooping** для проверки отслеживания DHCP и показа привязки **show ip dhcp snooping binding** для просмотра клиентов, которые получили информацию DHCP, как показано в примере.

**Примечание.** Отслеживание DHCP также требуется для проверки динамического ARP (DAI), которая является следующей темой.

```
S1# show ip dhcp snooping
Switch DHCP snooping is enabled
DHCP snooping is configured on following VLANs:
5,10,50-52
DHCP snooping is operational on following VLANs:
none
DHCP snooping is configured on the following L3 Interfaces:
Insertion of option 82 is enabled
   circuit-id default format: vlan-mod-port
   remote-id: 0cd9.96d2.3f80 (MAC)
Option 82 on untrusted port is not allowed
Verification of hwaddr field is enabled
Verification of giaddr field is enabled
DHCP snooping trust/rate is configured on the following Interfaces:
Interface                  Trusted    Allow option    Rate limit (pps)
-----------------------    -------    ------------    ----------------   
FastEthernet0/1            yes        yes             unlimited
  Custom circuit-ids:
FastEthernet0/5            no         no              6         
  Custom circuit-ids:
FastEthernet0/6            no         no              6         
  Custom circuit-ids:
S1# show ip dhcp snooping binding
MacAddress         IpAddress       Lease(sec) Type          VLAN Interface
------------------ --------------- ---------- ------------- ---- --------------------
00:03:47:B5:9F:AD  192.168.10.11   193185     dhcp-snooping 5    FastEthernet0/5
```

<!-- 11.3.5 -->
<!-- syntax -->
