<!-- 11.6.3 -->
## Обеспечение безопасности портов

Перед введением коммутатора в эксплуатацию необходимо обеспечить безопасность всех портов (интерфейсов) коммутатора. Самый простой и эффективный метод предотвращения атак переполнения таблицы MAC-адресов — это **обеспечение безопасности порта**. По умолчанию порты коммутатора уровня 2 настроены на динамический автоматический режим (транкинг включен). Коммутатор может быть настроен на изучение MAC-адресов на защищенном порту одним из трех способов: настраивается вручную, динамически запоминается и динамически запоминается — sticky.

Устаревание безопасности порта может использоваться для установки времени устаревания статических и динамических защищенных адресов на порту. Для каждого порта поддерживается два типа старения: абсолютный и по времени неактивности. Если MAC-адрес устройства, подключенного к порту, отличается от списка защищенных адресов, происходит нарушение (violation) порта. По умолчанию порт переходит в состояние отключения по ошибке (error-disabled).

Когда такое случается, трафик на этот порт не отправляется и не принимается. Для отображения параметров безопасности портов для коммутатора или заданного интерфейса воспользуйтесь командой **show port-security**.

## Отражение атак на виртуальные локальные сети

Чтобы нейтрализовать атаки VLAN-hopping, нужно предпринять несколько шагов.

**Шаг 1.** Отключите согласование DTP на немагистральных портах.  
**Шаг 2.** Отключите неиспользуемые порты.
**Шаг 3.** Вкручную включите транкинг на магистральном порту.  
**Шаг 4.** Отключите согласование DTP на магистральных портах.  
**Шаг 5.** Установите Native VLAN, отличную от VLAN 1.  

## Отражение атак через DHCP

Цель атаки с истощение DHCP — создать отказ в обслуживании (DoS) для подключения клиентов. Атаки DHCP-спуфинга можно предотвратить, используя анализ DHCP-трафика на доверенных портах. DHCP-Snooping определяет, получено ли сообщение от административно сконфигурированных доверенного или ненадежного источника. Затем он фильтрует сообщения и объем трафика из ненадежных источников. Чтобы включить отслеживание DHCP, выполните несколько шагов.

**Шаг 1**. Включите отслеживание DHCP.  
**Шаг 2**. На доверенных портах используйте команду настройки интерфейса **ip dhcp snooping trust**.  
**Шаг 3**. Ограничьте количество сообщений обнаружения DHCP, которые могут быть получены в секунду на ненадежных портах.  
**Шаг 4**. Включите отслеживание DHCP для VLAN или для диапазона VLAN.

## Отражение атак через ARP

Динамическая проверка ARP (DAI) требует отслеживания DHCP и помогает предотвратить атаки ARP. Это удается благодаря ее возможностям.

* Она не ретранслирует недопустимые или незапрошенные ответы ARP на другие порты в той же VLAN.
* Проводит перехват всех ARP-запросов и ответов на ненадежных портах.
* Проверяет каждый перехваченный пакет на предмет правильной привязки IP-к-MAC.
* Удаляет и регистрирует ARP-ответы, поступающие из недействительных портов, чтобы предотвратить «отравление» ARP.
* Отключает интерфейс, если настроенное число DAI пакетов ARP превышено.

Чтобы снизить вероятность подделки и «отравления» ARP, выполните следующие рекомендации по внедрению DAI:

* включите отслеживание DHCP на глобальном уровне;
* включите отслеживание DHCP на выбранных VLAN;
* включите DAI на выбранных VLAN;
* настройте доверенные интерфейсы для отслеживания DHCP и проверки ARP.

Рекомендуется настроить все порты коммутатора доступа как ненадежные и все порты, связывающие с вышестоящими устройствами, — как доверенные.

DAI также можно настроить для проверки MAC-адресов и IP-адресов назначения или источника.

* **Destination MAC.** Проверяет MAC-адрес назначения в заголовке Ethernet по отношению к целевому MAC-адресу в теле ARP.
* **Source MAC.** Проверяет MAC-адрес источника в заголовке Ethernet на соответствие MAC-адреса отправителя в теле ARP.
* **IP address.** Проверяет тело ARP на наличие недопустимых и неожиданных IP-адресов, включая 0.0.0.0, 255.255.255.255 и все IP-адреса многоадресной рассылки. 

## Отражение атак через STP

Чтобы нейтрализовать атаки манипуляций с STP, используйте средства защиты PortFast и Bridge Protocol Data Unit (BPDU).

* **PortFast.** Немедленно переводит интерфейс, настроенный как порт доступа или магистральный, в состояние пересылки из состояния блокировки, минуя прослушивание и обучение. Применить ко всем портам конечного пользователя. PortFast следует настраивать только на портах, подключенных к оконечным устройствам. Это средство обходит состояния прослушивания и обучения STP, чтобы минимизировать время, в течение которого порты доступа должны ожидать конвергенции STP. Если PortFast включен на порту, подключенном к другому коммутатору, существует риск создания коммутационной петли. 
* **BPDU Guard.** Немедленно при ошибке отключает порт, который получает BPDU. Как и PortFast, защита BPDU должна быть настроена только на интерфейсах, подключенных к оконечным устройствам. BPDU Guard можно включить с помощью команды **spanning-tree bpduguard enable** или **spanning-tree portfast bpduguard default** в глобальной конфигурации, чтобы включить защиту BPDU на всех портах с включенной PortFast. 

<!-- 11.6.4 -->
<!-- quiz -->
