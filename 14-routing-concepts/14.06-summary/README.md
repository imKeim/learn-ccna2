<!-- 14.6.1 -->
## Определение пути

Основными функциями роутера являются определение лучшего пути для пересылки пакетов на основе информации, содержащейся в таблице маршрутизации, и пересылка пакетов к месту назначения. Лучший путь в таблице маршрутизации также известен как самое длинное совпадение. В нем максимальное число крайних левых битов совпадает с IPv4-адресом назначения пакета.

**Непосредственно подключенные сети** — это сети, настроенные на активных интерфейсах роутера. Они добавляются в таблицу маршрутизации, когда интерфейс настроен с IP-адресом и маской подсети (длина префикса) и активен (up и up). Роутеры узнают о удаленных сетях двумя способами: через статические маршруты добавляются в таблицу при ручной настройке пути и через динамические протоколы маршрутизации.

Используя протоколы динамической маршрутизации, такие как EIGRP и OSPF, пути добавляются в таблицу, когда протоколы динамически узнают о удаленной сети.

## Пересылка пакетов

После того, как роутер определит правильный путь, он может переслать пакет через напрямую подключенную сеть, роутеру следующего перехода или отбросить пакет. Основной задачей функции пересылки пакетов является инкапсуляция пакетов в соответствующий тип кадра канала передачи данных для исходящего интерфейса. 

Роутеры поддерживают три механизма пересылки пакетов: коммутацию процессов, быструю коммутацию и CEF. Следующие шаги описывают процесс пересылки пакетов.

1. Кадр канального уровня с инкапсулированным IP-пакетом поступает на входной интерфейс.
2. Роутер проверяет IP-адрес назначения в заголовке пакета и обращается к своей таблице IP-маршрутизации.
3. Роутер находит самый длинный совпадающий префикс в таблице маршрутизации.
4. Роутер инкапсулирует пакет во кадр канального уровня выходного интерфейса и пересылает его из него. Назначением может быть устройство, подключенное к сети, или роутер следующего перехода.
5. Однако, если нет соответствующей записи маршрута, пакет отбрасывается.

## Обзор базовой конфигурации роутера

Существует несколько команд настройки и проверки для роутеров, в том числе **show ip route**, **show ip interface**, **show ip interface brief** и **show running-config**. Чтобы уменьшить объем выходных данных команды, используйте фильтр. 

Для отображения определенных разделов выходных данных можно использовать команды фильтрации. Чтобы включить фильтрацию, введите вертикальную черту (**|**) после команды **show**, а затем введите параметр и выражение фильтрации. К параметрам фильтрации, которые следует указывать после вертикальной черты, относятся:

* **section** — показать целый раздел, который начинается с заданного фильтра;
* **include** — включить все строки выходных данных, которые соответствуют заданному фильтру;
* **exclude** — исключить все строки выходных данных, которые соответствуют заданному фильтру;
* **begin** — показать все строки выходных данных от конкретного места, начиная с линии, которая соответствует заданному фильтру.

## Таблица IP маршрутизации

Таблица маршрутизации содержит список путей известных сетей (префиксы и длины префикса). Источником этой информации являются непосредственно подключенные сети, статические маршруты и протоколы динамической маршрутизации. К числу распространенных кодов таблицы маршрутизации относятся:

* **L** — указывает адрес, назначенный интерфейсу роутера, который позволяет устройству быстро определить, что полученный пакет предназначен для интерфейса, а не для пересылки;
* **C** — определяет сеть с прямым подключением;
* **S** — определяет статический маршрут, созданный для достижения конкретной сети;
* **O** — определяет сеть, динамически полученную от другого роутера с помощью протокола маршрутизатора OSPF;
* **\*** — маршрут является кандидатом на маршрут по умолчанию.

Каждый роутер принимает решение самостоятельно, основываясь на информации, содержащейся в собственной таблице маршрутизации. Информация в таблице одного роутера не обязательно совпадает с данными таблицы другого устройства. Информация о маршруте для пути не предоставляет возвратную информацию о маршруте. Записи таблицы маршрутизации включают источник маршрута, сеть назначения, AD, метрику, следующий переход, метку времени маршрута и интерфейс выхода. Чтобы узнать о удаленных сетях, роутер должен иметь по крайней мере один активный интерфейс, настроенный с IP-адресом и маской подсети (длина префикса), который называется сетью, подключенной напрямую.

Статические маршруты настраиваются вручную и определяют точный путь между двумя сетевыми устройствами. Протоколы динамической маршрутизации могут обнаруживать сеть, поддерживать таблицы, выбирать оптимальный путь и автоматически обнаруживать новый в случае изменения топологии.

Маршрут по умолчанию определяет роутер следующего перехода, который будет использоваться, если таблица маршрутизации не содержит определенного пути, соответствующего IP-адресу назначения. Маршрут по умолчанию может быть либо статическим, либо автоматически извлеченным из протокола динамической маршрутизации. Он имеет запись маршрута IPv4 0.0.0/0 или запись маршрута IPv6 ::/0.

Таблицы маршрутизации IPv4 по-прежнему имеют структуру, основанную на классовой адресации, представленной уровнями отступов. Для IPv6 они не используют структуру таблицы маршрутизации IPv4. В операционной системе Cisco IOS для определения маршрута и занесения его в таблицу применяется так называемое административное расстояние (AD). Эта величина выражает надежность маршрута. Чем ниже значение AD, тем выше надежность.

## Статическая и динамическая маршрутизация

Статические маршруты обычно используются:

* в качестве маршрута по умолчанию пересылаются пакеты поставщику услуг;
* для маршрутов за пределами домена, которые не были изучены протоколом динамической маршрутизации;
* когда сетевой администратор хочет явно определить путь для определенной сети;
* для маршрутизации между тупиковыми сетями.

Обычно используется протокол динамической маршрутизации:

* в сетях, состоящих из более чем нескольких роутеров;
* когда изменение топологии сети требует от сети автоматического определения другого пути;
* для масштабируемости по мере роста сети протокол динамической маршрутизации автоматически узнает о новых сетях.

Текущие протоколы маршрутизации включают IGP и EGPs. **Протоколы внутреннего шлюза** (IGP) — это протоколы маршрутизации, используемые для обмена информацией о маршрутизации в домене, управляемом одной организацией.

Единственным EGP является BGP. BGP обменивается информацией маршрутизации между различными организациями. BGP используется провайдерами для маршрутизации пакетов через Интернет. Протоколы маршрутизации вектора расстояния, состояния канала и векторного пути относятся к типу алгоритма маршрутизации, используемого для определения наилучшего пути.

Основными компонентами протоколов динамической маршрутизации являются структуры данных, сообщения протокола маршрутизации и алгоритмы. Протокол маршрутизации выбирает лучший путь, исходя из значения или метрики, используемых для определения расстояния до сети. **Метрика** — это числовое значение, используемое для измерения расстояния до заданной сети. Наиболее оптимальным путем к сети является путь с наименьшей метрикой. 

Если роутер располагает двумя или более путями к пункту назначения с метриками равной стоимости, он отправляет пакеты по обоим путям. Это называется распределением нагрузки в соответствии с равной стоимостью.

<!-- 14.6.2 -->
<!-- quiz -->
