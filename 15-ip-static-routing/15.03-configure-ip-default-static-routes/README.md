<!-- 15.3.1 -->
## Статический маршрут по умолчанию

В этом разделе показано, как настроить маршрут по умолчанию для IPv4 и IPv6. Он также объясняет ситуации, в которых маршрут по умолчанию является хорошим выбором. Статический маршрут по умолчанию — это маршрут, которому соответствуют все пакеты. Вместо хранения маршрутизаторами маршрутов для всех сетей в Интернете они могут хранить один маршрут по умолчанию, представляющий все сети, не добавленные в таблицу маршрутизации.

Маршрутизаторы обычно используют маршруты по умолчанию, настроенные локально или полученные от другого маршрутизатора, с помощью протокола динамической маршрутизации. Маршрут по умолчанию не требует совпадения никаких самых левых битов между маршрутом по умолчанию и IP адресом назначения. Маршрут по умолчанию используется, если ни один из маршрутов в таблице маршрутизации не совпадает с IP-адресом места назначения пакета. Иными словами, при отсутствии более точных совпадений в качестве «шлюза последней надежды» используется маршрут по умолчанию.

Статические маршруты по умолчанию обычно используются при подключении пограничного маршрутизатора к сети поставщика услуг или тупиковому маршрутизатору (маршрутизатор с только одним вышестоящим соседним маршрутизатором).

На рисунке показан типичный сценарий статического маршрута по умолчанию.

![](./assets/15.3.1.svg)


R1 должен знать только о напрямую подключенных сетях. Для остальных сетей я могу использовать статический маршрут по умолчанию, указывающий на маршрутизатор R2.

**Статический маршрут IPv4 по умолчанию**

Как показано на рисунке, синтаксис команды для статического маршрута по умолчанию аналогичен синтаксису команды для любого другого статического маршрута за исключением того, что адрес сети указывается как **0.0.0.0** а маска подсети – **0.0.0.0**. 0.0.0.0 0.0.0.0 в маршруте будет соответствовать любому сетевому адресу.

**Примечание**: Статический маршрут IPv4 по умолчанию обычно называют маршрутом с четырьмя нулями (quad-zero).

Синтаксис основной команды статического маршрутизатора по умолчанию следующий:

```
Router(config)# ip route 0.0.0.0 0.0.0.0 {ip-address | exit-intf}
```

**Статический маршрут IPv6 по умолчанию**

Синтаксис команд для статического маршрута по умолчанию похож на синтаксис команд для любого другого маршрута, за исключением того, что для параметра ipv6-prefix/prefix-length задано значение **::/0**, который совпадает совсеми маршрутами.

Основной синтаксис команды для статического маршрута по умолчанию для IPv6 выглядит следующим образом:

```
Router(config)# ipv6 route ::/0 {ipv6-address | exit-intf}
```

<!-- 15.3.2 -->
## Настройка статического маршрута по умолчанию

На рисунке R1 может быть настроен с тремя статическими маршрутами, по одному для достижения каждой из удаленных сетей в примере топологии. Однако R1 является тупиковым маршрутизатором, поскольку он связан только с маршрутизатором R2. Таким образом, гораздо более эффективным методом является настройка статического маршрута по умолчанию.

![](./assets/15.3.3.svg)
<!-- same as 15.3.2, dce is useless -->

В примере показан статический маршрут IPv4 по умолчанию, настроенный на R1. При использовании настройки, показанной в примере, все пакеты, не соответствующие записям более точного маршрута на R2, пересылаются на адрес 172.16.2.2.

```
R1(config)# ip route 0.0.0.0 0.0.0.0 172.16.2.2
```

Статический маршрут IPv6 по умолчанию настроен аналогичным образом. В этой конфигурации все пакеты, не соответствующие более конкретным записям маршрута IPv6, пересылаются в R2 в 2001:db8:acad:2::2.

```
R1(config)# ipv6 route ::/0 2001:db8:acad:2::2
```

<!-- 15.3.3 -->
## Проверка статического маршрута по умолчанию

![](./assets/15.3.3.svg)


**Проверка IPv4 статического маршрута по умолчанию**

На рисунке в выходных данных команды **show ip route static** отображается содержимое статических маршрутов в таблице маршрутизации. Обратите внимание на звездочку в выводе '*', далее на маршрут с **S**. Как показано в выводе команды **show ip route**, звездочка указывает, что этот статический маршрут является подходящим маршрутом по умолчанию, поэтому он выбран в качестве шлюза последней инстанции.

```
R1# show ip route static
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP 
D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2 
E1 - OSPF external type 1, E2 - OSPF external type 2 
i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2 
ia - IS-IS inter area, * - candidate default, U - per-user static route 
o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP 
+ - replicated route, % - next hop override 

Gateway of last resort is 172.16.2.2 to network 0.0.0.0

S* 0.0.0.0/0 [1/0] via 172.16.2.2 

R1#
```

**Проверка IPv6 статического маршрута по умолчанию**

Команда **show ipv6 route static** используется для отображения содержимого таблицы маршрутизации.

```
R1# show ipv6 route static
IPv6 Routing Table - default - 8 entries
Codes: C - Connected, L - Local, S - Static, U - Per-user Static route
       B - BGP, R - RIP, H - NHRP, I1 - ISIS L1
       I2 - ISIS L2, IA - ISIS interarea, IS - ISIS summary, D - EIGRP
       EX - EIGRP external, ND - ND Default, NDp - ND Prefix, DCE - Destination
       NDr - Redirect, RL - RPL, O - OSPF Intra, OI - OSPF Inter
       OE1 - OSPF ext 1, OE2 - OSPF ext 2, ON1 - OSPF NSSA ext 1
       ON2 - OSPF NSSA ext 2, la - LISP alt, lr - LISP site-registrations
       ld - LISP dyn-eid, lA - LISP away, le - LISP extranet-policy
       a - Application
S   ::/0 [1/0]
     via 2001:DB8:ACAD:2::2

R1#
```

Обратите внимание, что в статической конфигурации маршрута по умолчанию используется маска /0 для маршрутов по умолчанию IPv4 и префикс ::/0 для маршрутов по умолчанию IPv6. Помните, что маска подсети IPv4 и длина префикса IPv6 в таблице маршрутизации определяют, сколько бит должно совпадать между IP-адресом назначения пакета и маршрутом в таблице маршрутизации. Маска /0 или префикс ::/0 указывает, что ни один из битов не требуется для совпадения. Пока не появится более точное совпадение, статический маршрут по умолчанию соответствует всем пакетам.

<!-- 15.3.4 -->
<!-- syntax -->