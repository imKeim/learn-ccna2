# Настройка плавающих статических маршрутов

<!-- 15.4.1 -->
## Плавающие статические маршруты
Как и в других разделах этого модуля, вы узнаете, как настроить плавающие статические маршруты IPv4 и IPv6 и когда их использовать.

Еще одним типом статического маршрута является плавающий статический маршрут. Плавающие статические маршруты — это статические маршруты, используемые для предоставления резервного пути основному статическому маршруту или динамическому маршруту на случай сбоя в работе канала. Плавающий статический маршрут используется только тогда, когда основной маршрут недоступен.

Для этой цели плавающий статический маршрут настраивается с более высоким значением административного расстояния, чем основной маршрут. Административное расстояние определяет надежность маршрута. При наличии нескольких путей к адресу назначения маршрутизатор выбирает путь с самым низким значением административного расстояния.

Предположим, что администратору необходимо создать плавающий статический маршрут в качестве резервного для маршрута, получаемого по протоколу EIGRP. При настройке плавающего статического маршрута необходимо использовать более высокое значение административного расстояния, чем для EIGRP. EIGRP имеет административное расстояние 90. Если плавающий статический маршрут настроен с административным расстоянием 95, то динамический маршрут, установленный посредством EIGRP, имеет приоритет перед плавающим статическим маршрутом. Если маршрут, получаемый по EIGRP, утрачен, то вместо него используется плавающий статический маршрут.

На рисунке маршрутизатор филиала (Branch) перенаправляет весь трафик на маршрутизатор головного офиса (HQ) по частному каналу сети WAN. В этом примере маршрутизаторы осуществляют обмен данными о маршруте посредством протокола EIGRP. Плавающий статический маршрут с административным расстоянием, равным 91 или больше, можно настроить для использования в качестве резервного маршрута. При сбое частного канала сети WAN и удалении маршрута EIGRP из таблицы маршрутизации маршрутизатор выбирает плавающий статический маршрут как оптимальный путь для доступа к сети LAN головного офиса.

![](./assets/15.4.1.PNG)
<!-- /courses/srwe-dl/af9ef5a4-34fe-11eb-b1b2-9b1b0c1f7e0d/afb822f0-34fe-11eb-b1b2-9b1b0c1f7e0d/assets/caeec791-1c27-11ea-af09-3b2e6521927c.svg -->

1. Предпочтительным является маршрут, полученный с помощью динамической маршрутизации.
2. Если динамический маршрут потерян, будет использоваться плавающий статический маршрут.


По умолчанию статические маршруты имеют значение административного расстояния, равное 1, поэтому они имеют приоритет перед маршрутами, полученными от протоколов динамической маршрутизации. Например, для некоторых распространенных протоколов динамической маршрутизации используются следующие административные расстояния:

- EIGRP = 90
- OSPF = 110
- IS-IS = 115


Административную дистанцию статического маршрута можно увеличить и, таким образом, сделать этот маршрут менее приоритетным, чем другой статический маршрут или маршрут, полученный через протокол динамической маршрутизации. Таким образом, статический маршрут «плавает» и не используется в то время, когда маршрут с более коротким административным расстоянием работает. Однако, если предпочтительный маршрут потерян, плавающий статический маршрут может быть использован, и трафик будет оправлен по этому альтернативному маршруту.


<!--15.4.2-->
## Настройка плавающих статических маршрутов IPv4 и IPv6
Плавающие статические маршруты IP настраиваются с помощью **distance** аргумента для указания административного расстояния. Если значение административного расстояния не задано, используется значение по умолчанию (1).

Обратитесь к топологии на рисунке и к командам **ip route** и **ipv6 route** введенным на R1. В этом сценарии предпочтительным маршрутом по умолчанию от маршрутизатора R1 является маршрут к маршрутизатору R2. Подключение к маршрутизатору R3 должно использоваться только в качестве резервного подключения.

![](./assets/15.4.2.PNG)
<!-- /courses/srwe-dl/af9ef5a4-34fe-11eb-b1b2-9b1b0c1f7e0d/afb822f0-34fe-11eb-b1b2-9b1b0c1f7e0d/assets/caef63d0-1c27-11ea-af09-3b2e6521927c.svg -->

```
R1(config)# ip route 0.0.0.0 0.0.0.0 172.16.2.2
R1(config)# ip route 0.0.0.0 0.0.0.0 10.10.10.2 5
R1(config)# ipv6 route ::/0 2001:db8:acad:2::2
R1(config)# ipv6 route ::/0 2001:db8:feed:10::2 5
```

На маршрутизаторе R1 настроен статический маршрут по умолчанию, ведущий к маршрутизатору R2. Поскольку значение административного расстояния не задано, для статического маршрута используется значение по умолчанию (1). На маршрутизаторе R1 также настроены плавающие статические маршруты IPv4 и IPv6 по умолчанию, ведущий к маршрутизатору R3 с административным расстоянием, равным 5. Это значение превышает значение по умолчанию, равное 1, и, следовательно, этот маршрут является плавающим и не представлен в таблице маршрутизации до тех пор, пока не произойдет сбой в работе предпочтительного маршрута.

Команды **show ip route** и **show ipv6 route** показывает, что маршрут по умолчанию к маршрутизатору R2 записан в таблицу маршрутизации. Обратите внимание, что плавающий статический маршрут IPv4 к R3 отсутствует в таблице маршрутизации.

```
R1# show ip route static | begin Gateway
Gateway of last resort is 172.16.2.2 to network 0.0.0.0

S*   0.0.0.0/0 [1/0] via 172.16.2.2
R1# show ipv6 route static | begin S : 
S   ::/0 [1/0]
     via 2001:DB8:ACAD:2::2
R1#
```

Используйте команду **show run**, чтобы убедиться, что плавающие статические маршруты находятся в конфигурации. Например, следующий вывод команды проверяет, что оба статических маршрута по умолчанию IPv6 находятся в рабочей конфигурации.

```
R1# show run | include ipv6 route
ipv6 route ::/0 2001:db8:feed:10::2 5
ipv6 route ::/0 2001:db8:acad:2::2
R1#
```

<!--15.4.3-->
## Проверка плавающего статического маршрута
Что произойдет в случае неисправности маршрутизатора R2?

![](./assets/15.4.3.PNG)
<!-- /courses/srwe-dl/af9ef5a4-34fe-11eb-b1b2-9b1b0c1f7e0d/afb822f0-34fe-11eb-b1b2-9b1b0c1f7e0d/assets/caf02720-1c27-11ea-af09-3b2e6521927c.svg -->

Для того чтобы смоделировать подобный сбой, оба последовательных интерфейса маршрутизатора R2 должны быть выключены.

```
R2(config)# interface s0/1/0
R2(config-if)# shut
*Sep 18 23:36:27.000: %LINK-5-CHANGED: Interface Serial0/1/0, changed state to administratively down
*Sep 18 23:36:28.000: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial0/1/0, changed state to down
R2(config-if)# interface s0/1/1
R2(config-if)# shut
*Sep 18 23:36:41.598: %LINK-5-CHANGED: Interface Serial0/1/1, changed state to administratively down
*Sep 18 23:36:42.598: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial0/1/1, changed state to down
```

Обратите внимание, что маршрутизатор R1 автоматически создает сообщения о том, что последовательный интерфейс на маршрутизаторе R2 не работает.

```
R1#
*Sep 18 23:35:48.810: %LINK-3-UPDOWN: Interface Serial0/1/0, changed state to down
R1#
*Sep 18 23:35:49.811: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial0/1/0, changed state to down
R1#
```

Взгляд на таблицы IP-маршрутизации R1 подтверждает, что плавающие статические маршруты по умолчанию установлены в качестве маршрутов по умолчанию и указывают на R3 в качестве маршрутизатора следующего перехода.

```
R1# show ip route static | begin Gateway
Gateway of last resort is 10.10.10.2 to network 0.0.0.0
S*    0.0.0.0/0 [5/0] via 10.10.10.2
R1# show ipv6 route static | begin :: 
S   ::/0 [5/0] 
     via 2001:DB8:FEED:10::2
R1#
```
<!--15.4.4 Проверка синтаксиса: настройка статических плавающих маршрутов-->
