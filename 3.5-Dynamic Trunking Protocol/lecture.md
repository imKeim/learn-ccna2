# Динамический протокол транкинга (DTP)

<!-- 3.5.1 -->
## Знакомство с DTP

Некоторые коммутаторы Cisco имеют собственный протокол, который позволяет им автоматически согласовывать магистральные соединения с соседним устройством. Этот протокол называется протоколом динамического транкинга (DTP). DTP может ускорить процесс настройки для администратора сети. Магистральные интерфейсы Ethernet поддерживают различные режимы магистралей. Интерфейс может быть переведен в магистральный режим или режим без магистрали, либо настроен для согласования такого режима с соседним интерфейсом. Согласование магистрали управляется динамическим протоколом магистральных каналов (DTP), который действует по принципу подключения «точка-точка» между сетевыми устройствами.

Протокол DTP — это запатентованный протокол Cisco, который автоматически включён на коммутаторах Catalyst 2960 и Catalyst 3560. DTP управляет транковым согласованием только в случае, если порт соседнего коммутатора настроен в режиме транка, который поддерживает DTP. Коммутаторы других поставщиков не поддерживают DTP.

**Внимание**: Некоторые межсетевые устройства могут перенаправлять кадры DTP неправильно, что может привести к неправильным конфигурациям. Отключите протокол DTP на интерфейсах коммутатора Cisco, который подключен к устройствам, не поддерживающим DTP.

Конфигурация DTP по умолчанию для коммутаторов Cisco Catalyst 2960 и 3650 является динамической автоматической.

Чтобы включить транкинг от коммутатора Cisco к устройству, не поддерживающему DTP, используйте команды режима настройки интерфейса **switchport mode trunk** и **switchport nonegotiate**. Это приводит к тому, что интерфейс становится магистральным, но он не будет генерировать кадры DTP.

```
S1(config-if)# switchport mode trunk
S1(config-if)# switchport nonegotiate
```

Для повторного включения протокола динамического транкинга используйте команду **switchport mode dynamic auto**.

```
S1(config-if)# switchport mode dynamic auto
```

Если порты, соединяющие два коммутатора, настроены на игнорирование всех объявлений DTP с помощью команд **switchport mode trunk** и **switchport nonegotiate**, порты останутся в режиме магистрального порта. Если для подключения портов установлен динамический автоматический, они не будут согласовывать магистраль и останутся в состоянии режима доступа, создавая неактивное магистральный канал.

При настройке порта на работу в магистральном режиме используйте команду **switchport mode trunk**. В этом случае нет неоднозначности насчет состояния, в котором находится магистраль; она всегда включена.

<!-- 3.5.2 -->
## Согласованные режимы интерфейса

Команда **switchport mode** имеет дополнительные параметры согласования режима интерфейса. Полный синтаксис команды выглядит следующим образом:

```
Switch(config)# switchport mode { access | dynamic { auto | desirable } | trunk }
```

Параметры команды описаны в таблице.

| Параметр | Описание |
| --- | --- |
| **access** | Переводит интерфейс (порт доступа) в постоянный режим без транкинга и ведет переговоры о преобразовании канала в не магистральный канал.
Интерфейс становится немагистральным, независимо от того, является ли соседний интерфейс является магистральным интерфейсом. |
| **dynamic auto** | Делает интерфейс способным преобразовать канал в магистральный канал.
Интерфейс становится магистральным, если соседний интерфейс установлен в магистральный или желательный режим (desirable).
Режим порта коммутатора по умолчанию для всех интерфейсов Ethernet **dynamic auto**. |
| dynamic desirable | В этом режиме интерфейс активно пытается преобразовать канал связи в магистральный канал.
Интерфейс становится магистральным, если соседний интерфейс установлен в магистральный, желательный или динамический автоматический режим. |
| **trunk** | Переводит интерфейс в режим постоянного транкинга и выполняет согласование для преобразования соседнего канала в транковый канал.
Интерфейс становится магистральным, если соседний интерфейс не является интерфейсом транка. |

Используйте команду конфигурации интерфейса **switchport nonegotiate** для остановки согласования DTP. Коммутатор не участвует в согласовании DTP на этом интерфейсе. Эту команду можно использовать только в том случае, если режим порта коммутатора интерфейса находится в режиме **access** или **trunk**. Чтобы установить магистральный канал, необходимо вручную настроить соседний интерфейс в качестве магистрального интерфейса.

<!-- 3.5.3 -->
## Согласованные режимы интерфейса

В таблице показаны результаты настройки DTP на противоположных концах магистрального канала, подключенного к портам коммутатора Catalyst 2960. Рекомендации заключается в статической настройке транков, когда это возможно.

| | **Dynamic Auto** | **Dynamic Desirable** | **Trunk** | **Access** |
| --- | --- | --- | --- | --- |
| **Dynamic Auto** | Access | Trunk | Trunk | Access |
| **Dynamic Desirable** | Trunk | Trunk | Trunk | Access |
| **Trunk** | Trunk | Trunk | Trunk | Ограниченные возможности подключения |
| **Access** | Access | Access | Ограниченные возможности подключения | Access |

<!-- 3.5.4 -->
## Проверка режима протокола DTP

Режим DTP по умолчанию зависит от версии программного обеспечения Cisco IOS и платформы. Чтобы определить текущий режим DTP, выполните команду **show dtp interface**, как показано в выходных данных.

```
S1# show dtp interface fa0/1
DTP information for FastEthernet0/1:
TOS/TAS/TNS: ACCESS/AUTO/ACCESS
TOT/TAT/TNT: NATIVE/NEGOTIATE/NATIVE
Neighbor address 1: C80084AEF101
Neighbor address 2: 000000000000
Hello timer expiration (sec/state): 11/RUNNING
Access timer expiration (sec/state): never/STOPPED
Negotiation timer expiration (sec/state): never/STOPPED
Multidrop timer expiration (sec/state): never/STOPPED
FSM state: S2:ACCESS
# times multi & trunk 0
Enabled: yes
In STP: no
```

**Примечание**: При необходимости в магистральном канале рекомендуется задать режимы интерфейса **trunk** и **nonegotiate**. На каналах, в которых транковая связь не предусмотрена, DTP следует отключить.

<!-- 3.5.5 -->
## Packet Tracer. Настройка протокола DTP

В этом задании Packet Tracer вы будете настраивать и проверять DTP.

[Настройка динамического протокола транкинга (DTP) - PDF](./assets/3.5.5-packet-tracer---configure-dtp_ru-RU.pdf)

[Настройка динамического протокола транкинга (DTP) - PKA](./assets/3.5.5-packet-tracer---configure-dtp_ru-RU.pka)