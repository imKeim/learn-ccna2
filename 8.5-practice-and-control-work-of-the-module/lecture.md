<!-- 8.5.1 -->
## Лабораторная работа - Настройка DHCPv6

В этой лабораторной работе вы выполните следующие задачи.
* Часть 1: Создание сети и настройка основных параметров устройства
* Часть 2: Проверка назначения адреса SLAAC от R1
* Часть 3: Настройка и проверка сервера DHCPv6 без состояния на R1
* Часть 4: Настройка и проверка состояния DHCPv6 сервера на R1
* Часть 5: Настройка и проверка DHCPv6 Relay на R2

[Настройка  DHCPv6 (lab)](./assets/8.5.1-lab---configure-dhcpv6_ru-RU.pdf)

<!-- 8.5.2 -->
## Что я изучил в этом модуле?

## Назначение GUA IPv6

На маршрутизаторе глобальные одноадресные адреса IPv6 настраиваются вручную с помощью команды конфигурации интерфейса **ipv6 address** _ipv6-address/prefix-length_. Если выбрана автоматическая адресация IPv6, хост попытается автоматически получить и настроить информацию об адресах IPv6 на интерфейсе. Локальный адрес канала IPv6 автоматически создается хостом при загрузке и активном интерфейсе Ethernet. По умолчанию маршрутизатор с поддержкой IPv6 объявляет информацию IPv6, что позволяет хосту динамически создавать или приобретать конфигурацию IPv6. GUA IPv6 может быть назначен динамически с помощью служб без состояния и состояния. Решение о том, как клиент получит GUA IPv6, зависит от настроек в сообщении RA. Сообщение ICMPv6 RA содержит три флага для определения динамических параметров, доступных хосту:

* **Флаг А** - это флаг автонастройки адреса. Используйте SLAAC для создания GUA IPv6.
* **Флаг Other Configuration (флаг O)** - это флаг конфигурации Other. Другая информация доступна с сервера DHCPv6 без состояния.
* **Флаг Managed Address Configuration (флаг M)** - это флаг настройки управляемого (managed) адреса. Используйте сервер DHCPv6 с сохранением состояния для получения GUA IPv6.

## SLAAC

Метод SLAAC позволяет хостам создавать свой собственный уникальный глобальный одноадресный адрес IPv6 без использования служб DHCPv6 сервера. SLAAC использует ICMPv6-сообщения запроса маршрутизатора и объявления маршрутизатора, чтобы предоставить информацию об адресации и другую информацию о конфигурации, обычно предоставляемую DHCP-сервером. SLAAC может быть развернут только как SLAAC, или SLAAC с DHCPv6. Чтобы включить отправку сообщений RA, маршрутизатор должен присоединиться к группе IPv6 all-routers с помощью команды **ipv6 unicast-routing** global config. Используйте команду **show ipv6 interface**, чтобы проверить, включена ли маршрутизация. Метод SLAAC только включен по умолчанию при настройке команды ipv6 unicast-routing. Все включенные интерфейсы Ethernet с настроенным GUA IPv6 начнут отправлять сообщения RA с флагом A равным 1, а флаги O и M — 0. Флаг A = 1 предлагает клиенту создать свой собственный IPv6 GUA, используя префикс, объявленный в РА. Флаги O=0 и M=0 указывают клиенту использовать информацию исключительно в сообщении RA. Маршрутизатор отправляет RA-сообщения каждые 200 секунд. Тем не менее, он также отправит сообщение RA, если он получает сообщение RS от хоста. Используя SLAAC, хост обычно получает информацию о 64-битной подсети IPv6 от маршрутизатора RA. Однако он должен генерировать оставшийся 64-битный идентификатор интерфейса (ID) одним из двух методов: случайно сгенерированный или EUI-64. Процесс DAD используется хостом для обеспечения уникальности GUA IPv6. DAD реализован с использованием ICMPv6. Для выполнения DAD хост отправляет сообщение NS ICMPv6 со специально сконструированным адресом многоадресной рассылки, называемым адресом многоадресной рассылки запрошенного узла. Этот адрес дублирует последние 24 бита IPv6-адреса узла.

## DHCPv6

Если вариант работы DHCPv6 указан в сообщении RA, устройство начинает обмен данными по схеме клиент-сервер с использованием DHCPv6. Сообщения DHCPv6 от сервера к клиенту используют UDP-порт назначения 546, а сообщения DHCPv6 от клиента к серверу используют UDP-порт назначения 547. DHCPv6 без отслеживания состояния сообщает клиенту об использовании информации в сообщении RA для адресации, при этом дополнительные параметры конфигурации доступны с сервера DHCPv6. Это называется DHCPv6 без учета состояния, поскольку сервер не поддерживает сведения о состоянии клиента. DHCPv6 без состояния включен на интерфейсе маршрутизатора с помощью команды конфигурации интерфейса **ipv6 nd other-config-flag**. Это устанавливает флаг O в 1. В DHCPv6 с сохранением состояния сообщение RA сообщает клиенту получить всю информацию об адресации с сервера DHCPv6 с сохранением состояния, за исключением адреса шлюза по умолчанию, который является исходным IPv6 локальным адресом канала RA. Это называется состоянием, поскольку сервер DHCPv6 поддерживает информацию о состоянии IPv6. Протокол DHCPv6 с протоколом состояния включен на интерфейсе маршрутизатора с помощью команды конфигурации интерфейса **ipv6 nd managed-config-flag**. Это устанавливает флаг M в 1.

## Настройка сервера DHCPv6

Маршрутизатор Cisco IOS может быть настроен на предоставление служб сервера DHCPv6 в качестве одного из следующих трех типов: сервер DHCPv6, клиент DHCPv6 или агент ретрансляции DHCPv6. Параметр DHCPv6 сервера без учета состояния требует, чтобы маршрутизатор объявлял информацию о сетевой адресации IPv6 в сообщениях RA. Маршрутизатор также может быть клиентом DHCPv6 и получать конфигурацию IPv6 с сервера DHCPv6. Параметр DHCP-сервера с поддержкой состояния требует, чтобы маршрутизатор с поддержкой IPv6 сообщал узлу связаться с сервером DHCPv6 для получения всех необходимых сведений о сетевой адресации IPv6. Чтобы клиентский маршрутизатор был маршрутизатором DHCPv6, ему необходимо **have ipv6 unicast-routing** включить и локальный адрес канала IPv6 для отправки и получения сообщений IPv6. Используйте команды **show ipv6 dhcp pool** и **show ipv6 dhcp binding** для проверки работы DHCPv6 на маршрутизаторе. Если сервер DHCPv6 находится в сети, отличной от клиентской, маршрутизатор IPv6 можно настроить в качестве агента ретрансляции DHCPv6 с помощью команды **ipv6 dhcp relay destination** _ipv6-address \[interface-type interface-number \]_. Эта команда настраивается на интерфейсе, обращенном к клиентам DHCPv6, и указывает адрес сервера DHCPv6 и исходящий интерфейс для доступа к серверу. Исходящего интерфейса требуется только в том случае, если адрес следующего перехода является LLA. Убедитесь, что агент ретрансляции DHCPv6 работает с командами **show ipv6 dhcp interface** и **show ipv6 dhcp binding**.

<!-- 8.5.3 -->
<!-- quiz -->