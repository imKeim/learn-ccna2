<!-- 9.3.1 -->
## Протокол резервирования первого перехода (FHRP)

В случае сбоя маршрутизатора или интерфейса маршрутизатора (который выступает в качестве шлюза по умолчанию), узел, для которого настроено использование этого шлюза по умолчанию, изолируется от внешних сетей. Требуется механизм для предоставления альтернативных шлюзов по умолчанию в коммутируемых сетях, где два или более маршрутизаторов подключены к одним и тем же сетям VLAN. Один из способов устранения единой точки отказа на шлюзе по умолчанию — реализация виртуального маршрутизатора.

С виртуальным маршрутизатором несколько маршрутизаторов настроены для совместной работы, чтобы представить иллюзию одного маршрутизатора хостам в локальной сети. В случае сбоя активного маршрутизатора протокол резервирования переводит резервный маршрутизатор на новые функции активного маршрутизатора. В случае сбоя активного маршрутизатора происходит следующее.

1. Резервный маршрутизатор перестает видеть сообщения приветствия от пересылающего маршрутизатора.
2. Резервный маршрутизатор принимает роль передающего маршрутизатора.
3. Поскольку новый пересылающий маршрутизатор использует как адрес IPv4, так и MAC-адрес виртуального маршрутизатора, хост-устройства не замечают перебоев в обслуживании.

Использования конкретного протокола в значительной степени зависит от оборудования и потребностей сети. Существуют различные варианты реализации FHRP:

* HSRP и HSRP для IPv6
* VRRPv2 и VRRPv3
* GLBP и GLBP для IPv6
* IRDP

## HSRP

Проприетарный протокол Cisco FHRP, предназначенный для обеспечения сквозного переключения IPv4-устройства первого перехода. HSRP используется группой маршрутизаторов для выбора активного и резервного устройств. В рамках группы интерфейсов устройства активным называется устройство, используемое для маршрутизации пакетов; резервным — устройство, которое задействуется в случае сбоя активного устройства или при выполнении предварительно заданных условий. 

Задача резервного маршрутизатора HSRP заключается в мониторинге рабочего состояния группы HSRP и быстром переходе к выполнению функций пересылки пакетов в случае сбоя активного маршрутизатора. Маршрутизатор с наивысшим приоритетом HSRP станет активным маршрутизатором.

Приоритетное вытеснение (preemption) — это способность маршрутизатора HSRP запускать процесс повторного выбора. Если приоритетное вытеснение включено, то при появлении в сети маршрутизатора с более высоким приоритетом HSRP он становится активным маршрутизатором. Состояний HSRP включают начальные, обучающие, слушающие, говорящие и резервные.

<!-- 9.3.2 -->
<!-- quiz -->